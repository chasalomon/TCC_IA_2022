#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>

double nn(double inputs[], double output) {
	double mainWeights[] = {0.128666579723358, 0.032295536249876, -0.832649230957031, 0.118050850927830, 0.356973260641098, -0.161863833665848, -0.223990991711617, 0.711098194122314, 0.067699514329433, -0.372013807296753, 1.128382682800293, 1.201239466667175, -0.405930519104004, 0.757592618465424, 0.741104304790497, -0.748138964176178, -0.480039626359940, -1.202328920364380, 0.471120715141296, 0.572889924049377, -0.509391546249390, -1.541663646697998, -0.767228424549103, 0.216865375638008, -0.049430526793003, 1.103269577026367, -0.287209451198578, 0.654884934425354, -0.236083522439003, -0.768130064010620, -0.181852906942368, 1.731300711631775, 1.480623722076416, 0.674880325794220, -0.494894713163376, -0.024648016318679, 0.565765142440796, 0.910155832767487, 0.378295093774796, -0.075381755828857, -1.478814125061035, -0.189215824007988, -0.300142198801041, 0.106040127575397, -0.125128865242004, -0.500791609287262, -0.801315188407898, -0.422640591859818, 1.023904561996460, 0.594051063060760, 0.422886818647385, 1.121838331222534, 1.074563384056091, 0.492865860462189, 0.554938554763794, -0.249116316437721, -0.137889549136162, 0.681125581264496, -0.227094799280167, -0.799124598503113, 1.333997488021851, -3.975531578063965, -4.102455139160156, 0.885898232460022, -1.083682894706726, -0.268351584672928, -0.159111931920052, -0.450177431106567, -2.331003427505493, 1.661738991737366, 2.250151395797729, 1.648647308349609, -0.625497519969940, 0.425893992185593, -0.166108652949333, 1.709440827369690, -0.870882272720337, 0.103605374693871, -0.945971786975861, 1.435503721237183, -2.263731956481934, -1.119574189186096, -1.313604116439819, -1.087119579315186, 0.278689533472061, -1.146580457687378, 1.768271327018738, -0.463385134935379, -0.396250069141388, -1.153222441673279, -0.196809336543083, 2.350332498550415, 1.829024314880371, -0.802041172981262, 0.119667410850525, -0.044710714370012, -0.007683081086725, 0.412611961364746, 0.178275197744370, -0.161194473505020, -1.519295573234558, -0.021916585043073, -0.534957706928253, -1.147858977317810, 1.006867885589600, -2.098248243331909, 0.169462919235229, 0.273589432239532, -0.893192768096924, -1.387800812721252, 0.203980505466461, -0.004129387903959, 0.380319744348526, 0.597239673137665, 0.133658319711685, 0.624487280845642, -1.255682826042175, 0.488178014755249, -0.637071430683136, 0.785353302955627, 1.015923261642456, 0.461881905794144, -0.579954147338867, -0.447126120328903, 0.913244187831879, 0.899976074695587, -0.051248829811811, -0.319754183292389, -0.663979828357697, -0.252214640378952, -0.244269371032715, -0.036636132746935, 0.020620796829462, -0.795547306537628, 0.678973913192749, 0.976831197738647, 0.102410510182381, -0.060709841549397, -0.177092209458351, -1.007443070411682, -0.826660096645355, 0.159549415111542, -0.902419507503510, -0.498912304639816, 0.696752250194550, 0.400160014629364, -0.383426249027252, 0.014229644089937, -0.051260847598314, 0.989454269409180, 0.635586798191071, -0.176942959427834, -0.353369653224945, 0.643515467643738, 0.707807540893555, 0.369256198406219, -0.714932680130005, -0.338336884975433, -0.770774006843567, -0.259873747825623, -0.344397008419037, -0.300248682498932, 0.584597349166870, 0.609861969947815, -0.166112035512924, 1.052821040153503, -0.456291139125824, 0.141523554921150, 0.540437340736389, -0.811754703521729, 0.472348153591156, 1.337685465812683, 0.205484211444855, -0.473561853170395, 0.624661087989807, -0.856990218162537, -0.723988473415375, 0.815049111843109, 0.227805152535439, -0.480499595403671, -0.533453106880188, -1.102421879768372, -0.275400161743164, 0.314841210842133, 0.027369415387511, 0.222985029220581, -0.912116706371307, 1.076271176338196, 0.256913542747498, -0.280959635972977, 0.013566750101745, 0.122165106236935, -0.331862300634384, -0.076420582830906, -1.003437876701355, 0.962398290634155, 0.779325783252716, -0.442646741867065, 0.102000877261162, 0.912481606006622, -1.037835121154785, -0.547249257564545, -0.877707481384277, 0.293585717678070, -0.815641403198242, -0.316101908683777, -0.386536896228790, 0.016305316239595, -0.722286522388458, -0.216867953538895, -0.613872349262238, 1.201272010803223, 1.648262262344360, -0.184115216135979, -0.520360231399536, 0.059188008308411, 0.190286219120026, -0.564681589603424, 0.358193635940552, -0.201789319515228, -1.694476127624512, -1.068549036979675, -0.049263991415501, -0.565067470073700, 0.853555738925934, -0.077426582574844, 0.464971691370010, -0.714056074619293, 0.057644825428724, -1.104955077171326, 0.864040672779083, 1.906388878822327, 0.829178988933563, -0.041468314826488, 0.593874454498291, 0.190163731575012, -0.371059656143188, 0.555981099605560, 1.210318326950073, 0.135855332016945, -0.358408987522125, -2.105779647827148, -1.072861075401306, 0.219480991363525, 0.010284963995218, -0.490698456764221, 0.168419867753983, 0.643340528011322, 0.659566223621368, 0.465437620878220, 0.625285506248474, 1.079833030700684, -0.457886636257172, -0.423527687788010, 0.649127602577209, 0.724731206893921, -0.612372219562531, -0.419088959693909, -0.429455548524857, 0.518670856952667, -0.566395401954651, -0.732659637928009, -0.363086134195328, -0.363529562950134, 0.255046516656876, -0.468388885259628, 0.299478948116302, -1.219988465309143, -0.463458359241486, -0.265299439430237, 0.226672738790512, -0.520973265171051, -0.199688211083412, 0.008976229466498, 1.039597034454346, 0.680013239383698, -0.667834460735321, -0.404257684946060, -0.755321979522705, 0.560476481914520, -0.858497679233551, 0.909158170223236, -0.065169394016266, 0.552028298377991, 0.261233270168304, -1.055383920669556, -0.898316502571106, 0.989693224430084, 0.702549576759338, 0.326642185449600, 0.966409087181091, 0.248046055436134, 0.310386687517166, -0.439449340105057, 0.384288877248764, 0.496077120304108, 0.701659619808197, 0.793424725532532, -0.182528957724571, 0.725059628486633, 0.065138146281242, -2.240205287933350, -0.390082418918610, -0.111432470381260, 0.045199319720268, 0.746569395065308, 0.733865261077881, 0.381951540708542, -0.021186150610447, 0.116557098925114, 0.953008174896240, 0.329435825347900, -0.241353780031204, 0.793054223060608, -0.862292587757111, 1.588394641876221, -0.907642841339111, -0.891279697418213, -0.873689413070679, 0.764466404914856, -0.403041899204254, -1.823594927787781, -0.401746928691864, -0.120205670595169, 0.746636450290680, -0.907697498798370, -0.521646440029144, -0.964357733726501, 0.466203749179840, -0.332259058952332, -0.741683602333069, -0.332581788301468, -0.332680016756058, 0.105471685528755, -0.692763209342957, -0.231932848691940, 0.765474379062653, 0.001293738721870, 0.089411109685898, 0.250442832708359, 1.069406270980835, 0.136612445116043, -0.765563786029816, 1.110256075859070, 0.220643356442451, -0.597156524658203, 0.330180108547211, 0.662602961063385, -0.705308318138123, 1.065276861190796, -0.968550205230713, -0.458872914314270, 0.696960926055908, 0.440702706575394, -0.846490561962128, -0.394486814737320, 0.242479592561722, -0.597896516323090, 0.785511672496796, -0.685187816619873, -0.278379380702972, 0.084207855165005, 1.122116088867188, -0.928067564964294, 0.075423769652843, 0.262371659278870, 0.925723612308502, 0.113427795469761, 0.073817312717438, -1.103000640869141, -0.680107355117798, 0.041346676647663, -0.677862763404846, -0.950992286205292, -0.003267876338214, -1.570405364036560, 0.467625766992569, 0.385978460311890, -0.103668689727783, -0.919952809810638, 1.188900589942932, -0.755024492740631, 0.958818137645721, 0.820280075073242, -0.347718894481659, -1.062971949577332, -1.382310986518860, -0.449112206697464, -1.003534913063049, 0.679497182369232, -1.260315656661987, 3.326073646545410, 2.439806461334229, -0.167395383119583, -0.316004186868668, 0.476013779640198, 1.120374441146851, 0.438341528177261, 0.450924634933472, -0.827660501003265, -1.722769498825073, -0.578556716442108, -0.415309041738510, -0.046691346913576, -0.300317078828812, -3.592416048049927, -0.545391082763672, -0.398981750011444, 0.401190072298050, 0.555336534976959, 1.246459484100342, 0.834286332130432, -0.367585927248001, -0.240172505378723, -0.545445561408997, 0.003396121086553, -0.243436589837074, 1.229102373123169, -0.956283867359161, 0.486774176359177, -0.906224250793457, -0.162451565265656, -0.435742437839508, 0.459733575582504, 0.865663886070251, 0.539212107658386, -0.203232198953629, 0.053126238286495, 0.773906767368317, 0.216749474406242, -0.485722839832306, -0.196103706955910, 0.965960323810577, -0.482066869735718, 0.872149705886841, 0.469657093286514, -0.149766296148300, -0.588022172451019, 0.370038330554962, -0.425921320915222, 0.206296607851982, -0.500662028789520, -0.532380759716034, 0.377719521522522, -0.682270646095276, -0.714996635913849, -0.451396495103836, 0.367583602666855, -0.706225395202637, -0.511495769023895, 1.078910589218140, 2.028560876846313, -2.658333539962769, 8.771891593933105, -3.844369173049927, -0.455761075019836, -1.059397697448730, 1.852643251419067, -3.627866506576538, 2.918466091156006, -0.721220254898071, 3.617392778396606, 1.757312178611755, -2.142783403396606, -5.526689529418945, 0.308052092790604};
	double * mw = mainWeights;
	double hiddenLayer1outputs[15];
	int c;

	inputs[0] = -1.0 + (inputs[0] - 0.294271143000000) / 0.354507071500000;
	inputs[1] = -1.0 + (inputs[1] - 0.431586769000000) / 0.288967154000000;
	inputs[2] = -1.0 + (inputs[2] - 0.012643071000000) / 0.487203464500000;
	inputs[3] = -1.0 + (inputs[3] - 0.000000000000000) / 0.478210500000000;
	inputs[4] = -1.0 + (inputs[4] - 0.000000000000000) / 0.499941276500000;
	inputs[5] = -1.0 + (inputs[5] - 0.000000000000000) / 0.497577941000000;
	inputs[6] = -1.0 + (inputs[6] - 0.000000000000000) / 0.488637615500000;
	inputs[7] = -1.0 + (inputs[7] - 0.000000000000000) / 0.484007231000000;
	inputs[8] = -1.0 + (inputs[8] - 0.000000000000000) / 0.493283437500000;
	inputs[9] = -1.0 + (inputs[9] - 0.310526421000000) / 0.338948105500000;
	inputs[10] = -1.0 + (inputs[10] - 0.329997625000000) / 0.317620375000000;
	inputs[11] = -1.0 + (inputs[11] - 0.310587882000000) / 0.330588823500000;
	inputs[12] = -1.0 + (inputs[12] - 0.607143143000000) / 0.184285285500000;
	inputs[13] = -1.0 + (inputs[13] - 0.407902750000000) / 0.288687250000000;
	inputs[14] = -1.0 + (inputs[14] - 0.249360267000000) / 0.349088866500000;
	inputs[15] = -1.0 + (inputs[15] - 0.541324750000000) / 0.211155937500000;
	inputs[16] = -1.0 + (inputs[16] - 0.541273625000000) / 0.223737875000000;
	inputs[17] = -1.0 + (inputs[17] - 0.548749375000000) / 0.212301750000000;
	inputs[18] = -1.0 + (inputs[18] - 0.002117699000000) / 0.512041150500000;
	inputs[19] = -1.0 + (inputs[19] - 0.041393900000000) / 0.480423550000000;
	inputs[20] = -1.0 + (inputs[20] - 0.000000000000000) / 0.191532562500000;
	inputs[21] = -1.0 + (inputs[21] - 0.015273538000000) / 1.384973856000000;
	inputs[22] = -1.0 + (inputs[22] - 0.011489523000000) / 1.004065863500000;
	inputs[23] = -1.0 + (inputs[23] - 0.011306320000000) / 1.556846840000000;
	inputs[24] = -1.0 + (inputs[24] - 0.011916805000000) / 1.042882847500000;
	inputs[25] = -1.0 + (inputs[25] - 0.013930888000000) / 0.505733118500000;
	inputs[26] = -1.0 + (inputs[26] - 0.021636213000000) / 1.530216268500000;
	inputs[27] = -1.0 + (inputs[27] - 0.014480475000000) / 0.446369700000000;
	inputs[28] = -1.0 + (inputs[28] - 0.024902350000000) / 0.522705075000000;
	hiddenLayer1outputs[0] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[0] += *mw++ * inputs[c];
	hiddenLayer1outputs[0] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[0]));
	hiddenLayer1outputs[1] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[1] += *mw++ * inputs[c];
	hiddenLayer1outputs[1] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[1]));
	hiddenLayer1outputs[2] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[2] += *mw++ * inputs[c];
	hiddenLayer1outputs[2] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[2]));
	hiddenLayer1outputs[3] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[3] += *mw++ * inputs[c];
	hiddenLayer1outputs[3] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[3]));
	hiddenLayer1outputs[4] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[4] += *mw++ * inputs[c];
	hiddenLayer1outputs[4] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[4]));
	hiddenLayer1outputs[5] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[5] += *mw++ * inputs[c];
	hiddenLayer1outputs[5] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[5]));
	hiddenLayer1outputs[6] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[6] += *mw++ * inputs[c];
	hiddenLayer1outputs[6] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[6]));
	hiddenLayer1outputs[7] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[7] += *mw++ * inputs[c];
	hiddenLayer1outputs[7] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[7]));
	hiddenLayer1outputs[8] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[8] += *mw++ * inputs[c];
	hiddenLayer1outputs[8] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[8]));
	hiddenLayer1outputs[9] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[9] += *mw++ * inputs[c];
	hiddenLayer1outputs[9] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[9]));
	hiddenLayer1outputs[10] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[10] += *mw++ * inputs[c];
	hiddenLayer1outputs[10] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[10]));
	hiddenLayer1outputs[11] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[11] += *mw++ * inputs[c];
	hiddenLayer1outputs[11] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[11]));
	hiddenLayer1outputs[12] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[12] += *mw++ * inputs[c];
	hiddenLayer1outputs[12] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[12]));
	hiddenLayer1outputs[13] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[13] += *mw++ * inputs[c];
	hiddenLayer1outputs[13] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[13]));
	hiddenLayer1outputs[14] = *mw++;
	for(c = 0; c < 29; c++) hiddenLayer1outputs[14] += *mw++ * inputs[c];
	hiddenLayer1outputs[14] = 1.0 / (1.0 + exp(-hiddenLayer1outputs[14]));
	output = *mw++;
	for(c = 0; c < 15; c++) output += *mw++ * hiddenLayer1outputs[c];
	output = 1.0 / (1.0 + exp(-output));
	return output;
}

long getFileSize(FILE* fp)
{
   long size = 0;
   fpos_t pos;
   fseek(fp, 0, SEEK_END);
   size = ftell(fp);
   fseek(fp, 0, SEEK_SET);
   return size;
}

char* replace_char(char* str, char find, char replace){
    char *current_pos = strchr(str,find);
    while (current_pos) {
        *current_pos = replace;
        current_pos = strchr(current_pos,find);
    }
    return str;
}

void main(int argc, char *argv[]) {

	FILE *fp;
	long fileSize;
    char* fileContents;
    double inputs[29];
    char * splitted;
    char *eptr;
    double result;

	if ((fp=fopen ("dadostemp.csv","r+"))==NULL)
		printf ("Erro na abertura do arquivo.");
	else {
//		printf("Arquivo aberto com sucesso.");

	    /* Determine the size of the file */
	    fileSize = getFileSize(fp);

	    /* Allocate memory for the contents */
	    fileContents = malloc(fileSize+1);

	    /* Read the contents */
	    fread(fileContents, 1, fileSize, fp);

	    /* fread does not automatically add a terminating NULL character.
	        You must add it yourself. */
	    fileContents[fileSize] = '\0';

		splitted = replace_char(strtok(fileContents, ";"),',','.');
		splitted = replace_char(strtok(NULL, ";"),',','.');

		int i =0;

		while( i < 29 ) {
			result = strtod(splitted, &eptr);
	    	inputs[i] = result;
	    	splitted = replace_char(strtok(NULL, ";"),',','.');
//	    	printf("%dvalues...%f\n", i, inputs[i]);
	    	i++;
		}

		double output;
        output = nn(inputs, output);

//        printf("RESULT...%f\n", output);

        char finalResult = '0';

        if (output>=0.5){
            finalResult = '1';
        }

//        printf("SO...%c\n",finalResult);

        fseek(fp, -33, SEEK_END);
        fputc(finalResult, fp);
	}

//	printf("TERMINOU\n");
	fclose(fp);
}

